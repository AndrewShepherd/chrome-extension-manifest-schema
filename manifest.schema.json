{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Manifest",
  "description": "A Google Chrome extension manifest",
  "type": "object",
  "required": [ "manifest_version", "name", "version" ],

  "properties": {

    "manifest_version": {
      "type": "number",
      "description": "One integer specifying the version of the manifest file format your package requires.",
      "minimum": 2,
      "maxinum": 2
    },

    "name": {
      "type": "string",
      "description": "The name of the extension"
    },

    "version": {
      "$ref": "#/definitions/version_string",
      "description": "One to four dot-separated integers identifying the version of this extension."
    },

    "default_locale": {
      "type": "string",
      "description": "Specifies the subdirectory of _locales that contains the default strings for this extension.",
      "default": "en"
    },

    "description": {
      "type": "string",
      "description": "A plain text description of the extension",
      "maxLength": 132
    },

    "icons": {
      "type": "object",
      "description": "One or more icons that represent the extension, app, or theme. Recommended format: PNG; also BMP, GIF, ICO, JPEG.",
      "minProperties": 1,
      "properties": {
        "16": {
          "$ref": "#/definitions/icon",
          "description": "Used as the favicon for an extension's pages and infobar."
        },
        "48": {
          "$ref": "#/definitions/icon",
          "description": "Used on the extension management page (chrome://extensions)."
        },
        "128": {
          "$ref": "#/definitions/icon",
          "description": "Used during installation and in the Chrome Web Store."
        }
      }
    },

    "browser_action": {
      "$ref": "#/definitions/action",
      "description": "Use browser actions to put icons in the main Google Chrome toolbar, to the right of the address bar. In addition to its icon, a browser action can also have a tooltip, a badge, and a popup."
    },

    "page_action": {
      "$ref": "#/definitions/action",
      "description": "Use the chrome.pageAction API to put icons inside the address bar. Page actions represent actions that can be taken on the current page, but that aren't applicable to all pages."
    },

    "background": {
      "type": "object",
      "description": "The background page is an HTML page that runs in the extension process. It exists for the lifetime of your extension, and only one instance of it at a time is active.",
      "properties": {
        "persistent": {
          "type": "boolean",
          "description": "When false, makes the background page an event page (loaded only when needed).",
          "default": true
        },
        "page": {
          "$ref": "#/definitions/page",
          "description": "Specify the HTML of the background page.",
          "default": "background.html"
        },
        "scripts": {
          "$ref": "#/definitions/scripts",
          "description": "A background page will be generated by the extension system that includes each of the files listed in the scripts property.",
          "default": [ "background.js" ]
        }
      },
      "dependencies": {
        "page":    { "not": { "required": ["scripts"] } },
        "scripts": { "not": { "required": ["page"]    } }
      }
    },

    "chrome_url_overrides": {
      "type": "object",
      "description": "Override pages are a way to substitute an HTML file from your extension for a page that Google Chrome normally provides.",
      "properties": {
        "bookmarks": {
          "$ref": "#/definitions/page",
          "description": "The page that appears when the user chooses the Bookmark Manager menu item from the Chrome menu or, on Mac, the Bookmark Manager item from the Bookmarks menu. You can also get to this page by entering the URL chrome://bookmarks.",
          "default": "bookmarks.html"
        },
        "history": {
          "$ref": "#/definitions/page",
          "description": "The page that appears when the user chooses the History menu item from the Chrome menu or, on Mac, the Show Full History item from the History menu. You can also get to this page by entering the URL chrome://history.",
          "default": "history.html"
        },
        "newtab": {
          "$ref": "#/definitions/page",
          "description": "The page that appears when the user creates a new tab or window. You can also get to this page by entering the URL chrome://newtab.",
          "default": "newtab.html"
        }
      },
      "additionalProperties": false,
      "maxProperties": 1
    },

    "commands": {
      "type": "object",
      "description": "Use the commands API to add keyboard shortcuts that trigger actions in your extension, for example, an action to open the browser action or send a command to the extension.",
      "patternProperties": {
        ".*":                        { "$ref": "#/definitions/command" },
        "^_execute_browser_action$": { "$ref": "#/definitions/command" },
        "^_execute_page_action$":    { "$ref": "#/definitions/command" }
      }
    },

    "content_scripts": {
      "type": "array",
      "description": "Content scripts are JavaScript files that run in the context of web pages.",
      "minItems": 1,
      "uniqueItems": true,
      "items": {
        "type": "object",
        "required": ["matches"],
        "properties": {
          "matches": {
            "type": "array",
            "description": "Specifies which pages this content script will be injected into.",
            "items": { "$ref": "#/definitions/match_pattern" },
            "minItems": 1,
            "uniqueItems": true
          },
          "exclude_matches": {
            "type": "array",
            "description": "Excludes pages that this content script would otherwise be injected into.",
            "items": { "$ref": "#/definitions/match_pattern" },
            "uniqueItems": true
          },
          "css": {
            "type": "array",
            "description": "The list of CSS files to be injected into matching pages. These are injected in the order they appear in this array, before any DOM is constructed or displayed for the page.",
            "items": { "$ref": "#/definitions/uri" },
            "uniqueItems": true
          },
          "js": {
            "$ref": "#/definitions/scripts",
            "description": "The list of JavaScript files to be injected into matching pages. These are injected in the order they appear in this array."
          },
          "run_at": {
            "type": "string",
            "description": "Controls when the files in js are injected.",
            "enum": [ "document_start", "document_end", "document_idle" ],
            "default": "document_idle"
          },
          "all_frames": {
            "type": "boolean",
            "description": "Controls whether the content script runs in all frames of the matching page, or only the top frame.",
            "default": false
          },
          "include_globs": {
            "type": "array",
            "description": "Applied after matches to include only those URLs that also match this glob. Intended to emulate the @include Greasemonkey keyword.",
            "items": { "$ref": "#/definitions/glob_pattern" },
            "uniqueItems": true
          },
          "exclude_globs": {
            "type": "array",
            "description": "Applied after matches to exclude URLs that match this glob. Intended to emulate the @exclude Greasemonkey keyword.",
            "items": { "$ref": "#/definitions/glob_pattern" },
            "uniqueItems": true
          }
        },
        "additionalProperties": false
      }
    },

    "content_security_policy": {
      "type": "string",
      "description": "This introduces some fairly strict policies that will make extensions more secure by default, and provides you with the ability to create and enforce rules governing the types of content that can be loaded and executed by your extensions and applications.",
      "format": "content_security_policy",
      "default": "script-src 'self'; object-src 'self'"
    },

    "devtools_page": {
      "$ref": "#/definitions/page",
      "description": "A DevTools extension adds functionality to the Chrome DevTools. It can add new UI panels and sidebars, interact with the inspected page, get information about network requests, and more."
    },

    "chrome_settings_overrides": {},
    "content_pack": {},
    "current_locale": {}

  },

  "dependencies": {

    "page_action":     { "not": { "required": ["browser_action"]  } },
    "browser_action":  { "not": { "required": ["page_action"]     } },

    "background_page":            { "not": { "required": ["background_page"]            } } ,
    "page_actions":               { "not": { "required": ["page_actions"]               } } ,
    "browser_actions":            { "not": { "required": ["browser_actions"]            } } ,
    "author":                     { "not": { "required": ["author"]                     } } ,
    "converted_from_user_script": { "not": { "required": ["converted_from_user_script"] } }

  },

  "definitions": {

    "action": {
      "type": "object",
      "properties": {
        "default_title": {
          "type": "string",
          "description": "Tooltip for the main toolbar icon."
        },
        "default_popup": {
          "$ref": "#/definitions/uri",
          "description": "The popup appears when the user clicks the icon."
        },
        "default_icon": {
          "anyOf": [
            {
              "type": "string",
              "description": "FIXME: String form is deprecated."
            },
            {
              "type": "object",
              "description": "Icon for the main toolbar.",
              "properties": {
                "19": {
                  "$ref": "#/definitions/icon"
                },
                "38": {
                  "$ref": "#/definitions/icon"
                }
              }
            }
          ]
        }
      },

      "dependencies": {
        "name":  { "not": { "required": ["name"]  } },
        "icons": { "not": { "required": ["icons"] } },
        "popup": { "not": { "required": ["popup"] } }
      }
    },

    "command": {
      "type": "object",
      "properties": {
        "description": {
          "type": "string"
        },
        "suggested_key": {
          "type": "object",
          "patternProperties": {
            "^(default|mac|windows|linux|chromeos)$": {
              "type": "string",
              "pattern": "^(Ctrl|Command|MacCtrl|Alt|Option)\\+(Shift\\+)?[A-Z]"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "glob_pattern": {
      "type": "string",
      "format": "glob_pattern"
    },

    "icon": { "$ref": "#/definitions/uri" },

    "match_pattern": {
      "type": "string",
      "format": "match_pattern",
      "pattern": "<all_urls>|((\\*|http|https|file|ftp|chrome-extension):\\/\\/(\\*|\\*\\.[^\\/\\*]+|[^\\/\\*]+)?(\\/.*))"
    },

    "page": { "$ref": "#/definitions/uri" },

    "scripts": {
      "type": "array",
      "items": { "$ref": "#/definitions/uri" },
      "minItems": 1,
      "uniqueItems": true
    },

    "uri": {
      "type": "string",
      "format": "uri"
    },

    "version_string": {
      "type": "string",
      "format": "version_string",
      "pattern": "^(?:\\d{1,5}\\.){0,3}\\d{1,5}$"
    }

  }
}
